name: Generate Changelog

on:
  workflow_dispatch:
    inputs:
      nextVersion:
        description: 'Next version (eg.: 2.20.0)'
        required: true
        type: string
      shortDescription:
        description: 'Short description'
        required: true
        type: string

jobs:
  generate_changelog:
    name: "Generate Changelog"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2.4.0
        with:
          fetch-depth: 0
      - name: Generate Changelog
        uses: actions/github-script@v5
        with:
          script: |
            const util = require('util');
            const execFile = util.promisify(require('child_process').execFile);
            const {stdout} = await execFile('ls', ['-l']);
            console.log("ls -l:");
            console.log(stdout);
            const nextVersion = process.env.NEXT_VERSION;
            const shortDescription = process.env.SHORT_DESCRIPTION;
            const {run} = require('./.github/workflows/scripts/generate-changelog.cjs');
            await run({nextVersion, shortDescription});
        env:
          NEXT_VERSION: ${{github.event.inputs.nextVersion}}
          SHORT_DESCRIPTION: ${{github.event.inputs.shortDescription}}
